<!DOCTYPE html>
<html>
<head>
    <title>LXGLAM - Simple Telegram Form</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .success { color: green; margin-top: 10px; padding: 10px; background: #d4edda; border-radius: 4px; }
        .error { color: red; margin-top: 10px; padding: 10px; background: #f8d7da; border-radius: 4px; }
        .info { background: #e7f3ff; padding: 15px; border-radius: 4px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>ü§ñ LXGLAM Telegram Booking Form</h1>
    
    <div class="info">
        <h3>‚úÖ Your Bot is Ready!</h3>
        <p><strong>Chat ID:</strong> 5268028095</p>
        <p><strong>Bot:</strong> @lxglambot</p>
        <p><strong>Status:</strong> Ready to receive booking requests</p>
    </div>
    
    <form id="telegramForm">
        <div class="form-group">
            <label for="name">Client Name *</label>
            <input type="text" id="name" required>
        </div>
        
        <div class="form-group">
            <label for="phone">Phone Number *</label>
            <input type="tel" id="phone" required>
        </div>
        
        <div class="form-group">
            <label for="master">Beauty Master</label>
            <select id="master">
                <option value="Julya">Julya - Brow & Lash Master</option>
                <option value="Natalia">Natalia - Manicure & Pedicure Master</option>
                <option value="Kseniya">Kseniya - Hair Transformation Master</option>
                <option value="Dmytro">Dmytro - Haircut & Styling Master</option>
                <option value="Kristina">Kristina - Facial & Aesthetic Master</option>
                <option value="Anna">Anna - Keratin & Hair Botox Master</option>
                <option value="Kayo">Kayo - Hair & Beauty Master</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="service">Service Requested</label>
            <input type="text" id="service" placeholder="e.g., Hair coloring, Manicure, etc.">
        </div>
        
        <div class="form-group">
            <label for="datetime">Preferred Date & Time</label>
            <input type="datetime-local" id="datetime">
        </div>
        
        <div class="form-group">
            <label for="notes">Additional Notes</label>
            <textarea id="notes" rows="3" placeholder="Any special requests or notes..."></textarea>
        </div>
        
        <button type="submit">Send Booking Request to Telegram</button>
    </form>
    
    <div id="result"></div>

    <script>
        document.getElementById('telegramForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                master: document.getElementById('master').value,
                service: document.getElementById('service').value,
                datetime: document.getElementById('datetime').value,
                notes: document.getElementById('notes').value
            };
            
            const resultDiv = document.getElementById('result');
            const submitBtn = this.querySelector('button');
            const originalText = submitBtn.textContent;
            
            submitBtn.textContent = 'Sending to Telegram...';
            submitBtn.disabled = true;
            
            try {
                // Try serverless function first
                const response = await fetch('/.netlify/functions/send-booking', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    resultDiv.innerHTML = `<div class="success">‚úÖ ${result.message}</div>`;
                    this.reset();
                } else {
                    throw new Error('Serverless function failed');
                }
            } catch (error) {
                console.log('Serverless function failed, trying direct method...');
                
                try {
                    // Fallback: Direct Telegram API call
                    const message = `üéØ *New LXGLAM Booking Request*

üë§ *Client:* ${formData.name}
üìû *Phone:* ${formData.phone}
üë®‚Äçüíº *Master:* ${formData.master}
üíÖ *Service:* ${formData.service || 'Not specified'}
üìÖ *Date & Time:* ${formData.datetime ? new Date(formData.datetime).toLocaleString() : 'Flexible'}
üìù *Notes:* ${formData.notes || 'None'}

Please contact the client to confirm the appointment.`;

                    // Use a CORS proxy
                    const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                    const telegramUrl = 'https://api.telegram.org/bot8466676132:AAHi1-a_KbTrk1KRP90I1iT6Ip4UBLRxUmg/sendMessage';
                    
                    const response = await fetch(proxyUrl + telegramUrl, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        body: JSON.stringify({
                            chat_id: '5268028095',
                            text: message,
                            parse_mode: 'Markdown'
                        })
                    });
                    
                    if (response.ok) {
                        resultDiv.innerHTML = '<div class="success">‚úÖ Booking request sent successfully to your Telegram chat!</div>';
                        this.reset();
                    } else {
                        throw new Error('Failed to send to Telegram');
                    }
                } catch (fallbackError) {
                    console.error('Both methods failed:', fallbackError);
                    resultDiv.innerHTML = `<div class="error">‚ùå Error: ${fallbackError.message}<br><br>Please try again or contact us directly.</div>`;
                }
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
